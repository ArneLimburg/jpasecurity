<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<article id="rules">
  <title>Providing access rules</title>
  <para>
    With JPA Security there are two predefined ways to provide access rules:
    via XML configuration or via Annotations. You may implement your own way
    of providing access rules (i.e. via JDBC) by implementing the interface
    <programlisting>net.sf.jpasecurity.security.rules.AccessRulesProvider</programlisting>.
    Take a look at its javadoc documentation for further reference.
  </para>
  <section id="rules:xml">
    <title>Access rules via XML</title>
    <para>
      One predefined way to provide access rules in JPA Security is via a file
      called <quote>security.xml</quote>, which is located in the <quote>META-INF</quote>
      directory of your application. Below is an example of the structure of such file:
    </para>
    <programlisting>
&lt;security xmlns="http://jpasecurity.sf.net/xml/ns/security"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://jpasecurity.sf.net/xml/ns/security
                              http://jpasecurity.sf.net/xml/ns/security/security_1_0.xsd"
          version="1.0"&gt;

  &lt;persistence-unit name="..."&gt;
    &lt;access-rule&gt;...&lt;/access-rule&gt;
    ...
  &lt;/persistence-unit&gt;
&lt;/security&gt;
    </programlisting>
    <para>
      You have to specify <programlisting>net.sf.jpasecurity.security.rules.provider</programlisting>
      with the value <programlisting>net.sf.jpasecurity.security.rules.XmlAccessRulesProvider</programlisting>
      within your persistence properties in order to provide your access rules this way.
    </para>
  </section>
  <section id="rules:annotations">
    <title>Access rules via Annotations</title>
    <para>
      The other predefined way to provide access rules in JPA Security is via Annotations.
      You may annotate your entity classes with one of the following two annotations:
      <programlisting>javax.annotation.security.RolesAllowed</programlisting> and
      <programlisting>net.sf.jpasecurity.security.rules.Permit</programlisting>.
    </para>
    <para>
      Note that the semantics of the <programlisting>@RolesAllowed</programlisting> annotation slightly differs
      between the EJB Specification and JPA Security: If you annotate a class with the
      <programlisting>@RolesAllowed</programlisting> annotation this means for EJB any access to any method
      of an instance of that class will cause a <programlisting>SecurityException</programlisting>, if the
      current user is not in one of the roles allowed. JPA Security goes a step further:
      The current user will not retrieve this object from database if he is not in one of
      the roles allowed. JPA Security does not support the <programlisting>@RolesAllowed</programlisting>
      annotation at method-level.
    </para>
    <para>
      The <programlisting>Permit</programlisting> annotation has an optional parameter <programlisting>where</programlisting>.
      With this parameter you can specify your restrictions for entities
      of the annotated class.
    </para>
    <para>
      You have to specify <programlisting>net.sf.jpasecurity.security.rules.provider</programlisting>
      with the value <programlisting>net.sf.jpasecurity.security.rules.AnnotationAccessRulesProvider</programlisting>
      within your persistence properties in order to provide your access rules via annotations.
    </para>
  </section>
</article>
